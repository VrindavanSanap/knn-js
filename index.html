<html>

<head>
  <title>KNN K Nearest Neighbors in Javascript: demo</title>
  <link type="text/css" href="./demo/jqueryui/css/ui-lightness/jquery-ui-1.8.21.custom.css" rel="Stylesheet" />
  <script type="text/javascript" src="./demo/jqueryui/js/jquery-1.7.2.min.js"></script>
  <script type="text/javascript" src="./demo/jqueryui/js/jquery-ui-1.8.21.custom.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
  <script src="./demo/npg_include/npgmain.js"></script>
  <script src="./lib/knn.js"></script>
  <script src="./lib/fixed_ui.js"></script>
  <script type="text/javascript">



    var dist = "2"
    var K = "1"
    var grid = tf.zeros([500, 500])

    var density = 4.0;
    var data
    var labels
    var knn = new knnjs.KNN()
    function myinit() {
      data = tf.tensor2d([
        [21, 300],
        [30, 40],
        [153, 376],
        [277, 173],
        [165, 17],
        [133, 211],
        [258, 368],
        [117, 293],
        [432, 144],
        [136, 177]]);
      labels = tf.tensor2d([[1],
      [1],
      [1],
      [1],
      [1],
      [-1],
      [-1],
      [-1],
      [-1],
      [-1]]);

      retrain()
    }
    function retrain() {
      let grid_coords = []
      for (let x = 0.0; x <= WIDTH; x += density) {

        let temp = []
        for (let y = 0.0; y <= WIDTH; y += density) {
          temp.push([x, y])
        }
        grid_coords.push(temp)
      }
      let mat1 = tf.tensor3d(grid_coords)
      console.log(mat1.arraySync())
      var grid = knn.train(data, labels)
    }

    function update() {
    }
    function draw_grid() {
      ctx.clearRect(0, 0, WIDTH, HEIGHT);
      gridd = grid.arraySync()
      for (let x = 0.0; x <= WIDTH; x += density) {
        for (let y = 0.0; y <= HEIGHT; y += density) {
          if (gridd[x / density][y / density] > 0) ctx.fillStyle = `rgb(150,250,150)`;
          else ctx.fillStyle = 'rgb(250,150,150)';
          ctx.fillRect(x - density / 2 - 1, y - density - 1, density + 2, density + 2);
        }
      }
    }



    function draw() {
      draw_grid()
      draw_axes()
      draw_circles()
      write_config()
    }

    function mouseClick(x, y, shiftPressed) {

      // add datapoint at location of click
      data = data.concat(tf.tensor2d([[x, y]]))
      const new_label = shiftPressed ? 1 : -1;
      labels = labels.concat(tf.tensor2d([[new_label]]))
      retrain()
    }


    function keyDown(key) {
    }


    // UI stuff
    function refreshC(event, ui) {

      K = ui.value;

      $("#creport").text(`K = ${K}`);

    }

    function refreshSig(event, ui) {
      dist = ui.value;

      $("#sigreport").text(`L${dist} Distance`);
    }

    $(function () {
      // for C parameter
      $("#slider1").slider({
        orientation: "horizontal",
        slide: refreshC,
        max: 10,
        min: 1,
        step: 1,
        value: 1
      });

      // for rbf kernel sigma
      $("#slider2").slider({
        orientation: "horizontal",
        slide: refreshSig,
        max: 10,
        min: 1,
        step: 1,
        value: 1
      });
    });
  </script>

  <style type="text/css">
    canvas {
      border: 1px solid #555;
      margin-top: 10px;
    }

    body {
      text-align: center;
      font-family: Verdana, Helvetica, sans-serif;
      font-size: 12px;
      padding: 0;
      margin: 0;
    }

    h1 {
      font-size: 16px;
    }

    p {
      padding-top: 0;
      padding-bottom: 0;
    }

    #dec {
      width: 100%;
      height: 100px;
      background-color: #F5FAFF;
      border-bottom: 1px solid #E5EAEF;
      margin-bottom: 20px;
    }

    #optsdiv {
      width: 500px;
      margin-left: auto;
      margin-right: auto;
    }
  </style>

</head>

<body onLoad="NPGinit(0.5);">
  <div id="dec">
    <br />
    <h1>K Nearest Neighbors in Javascript</h1>
    <p>
      Heavily inspired by svmjs by Andrej Karpathy <a href="https://github.com/karpathy/svmjs">Github</a> <br />
      <!-- Find me on Twitter <a href="https://twitter.com/karpathy">@karpathy</a> -->
    </p>
  </div>

  <p>
    <b>mouse click</b>: add red data point<br />
    <b>shift + mouse click</b>: add green data point<br />
    <b>'k'</b>: toggle between Linear and Rbf kernel<br />
    <b>'r'</b>: reset<br />
  </p>

  <canvas id="NPGcanvas" width="500" height="500">Browser not supported for Canvas. Get a real
    browser.</canvas><br /><br />

  <div id="optsdiv">
    <div style="width:230px; float: left; margin-left: 10px;">
      <div id="slider1"></div><br /><span id="creport">K = 1</span>
    </div>
    <div style="width:230px; float: right; margin-right: 10px;">
      <div id="slider2"></div><br /><span id="sigreport">L2 distance</span>
    </div>
  </div>


</body>

</html>